<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pencarian Jadwal Dosen</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-3">

<div class="max-w-sm mx-auto">

  <h2 class="text-lg font-semibold mb-3 text-gray-800 text-center">
    üîé Cari Nama Dosen
  </h2>

  <input 
    type="text" 
    id="searchInput"
    placeholder="minimal 3 huruf..."
    class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
  >

  <button 
    onclick="cariDosen()"
    class="w-full mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
  >
    Cari
  </button>

  <div id="message" class="mt-3 text-sm text-gray-500 text-center"></div>
  <div id="results" class="mt-4 space-y-3"></div>
  <div id="detail" class="mt-6"></div>

</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzDriaNyxlLy_-BxY6BCYkbibonLoEXfnos41T5JCMJzjFdJmkqOQTXj-IVPOrBYwz3/exec";

const warnaList = [
  "border-blue-500",
  "border-green-500",
  "border-red-500",
  "border-purple-500",
  "border-orange-500",
  "border-teal-500"
];

let globalData = [];

function cariDosen() {

  const keyword = document.getElementById("searchInput").value.trim();
  const messageDiv = document.getElementById("message");

  document.getElementById("results").innerHTML = "";
  document.getElementById("detail").innerHTML = "";
  messageDiv.innerHTML = "";

  if (keyword.length < 3) {
    messageDiv.innerHTML = "Minimal 3 huruf untuk mencari.";
    return;
  }

  messageDiv.innerHTML = "Loading...";

  fetch(API_URL + "?search=" + encodeURIComponent(keyword))
    .then(res => res.json())
    .then(data => {
      globalData = data;
      tampilkanDaftarDosen(data);
    })
    .catch(() => {
      messageDiv.innerHTML = "Terjadi kesalahan mengambil data.";
    });
}

function tampilkanDaftarDosen(data) {

  const resultsDiv = document.getElementById("results");
  const messageDiv = document.getElementById("message");

  resultsDiv.innerHTML = "";
  document.getElementById("detail").innerHTML = "";

  if (!data || data.length === 0) {
    messageDiv.innerHTML = "Data tidak ditemukan.";
    return;
  }

  messageDiv.innerHTML = "Pilih nama dosen:";

  const dosenUnik = [...new Set(data.map(item => item.dosen))];

  dosenUnik.forEach(nama => {

    const btn = document.createElement("div");

    btn.className = `
      bg-white
      px-4 py-3
      rounded-lg
      border
      hover:bg-blue-50
      cursor-pointer
      transition
      shadow-sm
      text-sm
    `;

    btn.innerHTML = `<div class="font-medium text-gray-800">${nama}</div>`;

    btn.onclick = function() {
      tampilkanKelasDosen(nama);
    };

    resultsDiv.appendChild(btn);
  });
}

function tampilkanKelasDosen(namaDosen) {

  const resultsDiv = document.getElementById("results");
  const messageDiv = document.getElementById("message");

  resultsDiv.innerHTML = "";
  document.getElementById("detail").innerHTML = "";
  messageDiv.innerHTML = "Pilih kelas:";

  const kelasDosen = globalData.filter(item => item.dosen === namaDosen);

  kelasDosen.forEach((item, index) => {

    const warna = warnaList[index % warnaList.length];

    const card = document.createElement("div");

    card.className = `
      kelas-card
      border-l-4 ${warna}
      bg-white
      p-4
      rounded-xl
      shadow-sm
      hover:shadow-lg
      cursor-pointer
      transition
      transform
      hover:-translate-y-1
      active:scale-95
    `;

    card.innerHTML = `
      <div class="font-semibold text-gray-800">
        ${item.matkul}
      </div>

      <div class="mt-3 inline-block px-3 py-1 bg-orange-100 rounded-full text-xs">
        <span class="text-gray-500 font-medium">PRODI:</span>
        <span class="text-orange-700 font-semibold">${item.prodi}</span>
      </div>

      <div class="text-sm text-gray-600 mt-2">
        Kelas ${item.kelas}
      </div>
    `;

    card.onclick = function() {

      document.querySelectorAll(".kelas-card")
        .forEach(k => { if (k !== card) k.classList.add("hidden"); });

      tampilkanDetail(item, warna, namaDosen);
    };

    resultsDiv.appendChild(card);
  });
}

function tampilkanDetail(item, warna, namaDosen) {

  const detailDiv = document.getElementById("detail");

  detailDiv.innerHTML = `
    <div class="border-l-4 ${warna} bg-white p-5 rounded-xl shadow-md">
      <h3 class="font-semibold text-gray-800 mb-3">Detail Kelas</h3>

      <div class="mb-4 text-sm text-gray-700 space-y-1">
        ${item.hari ? `<div><b>Hari:</b> ${item.hari}</div>` : ``}
        ${item.jam ? `<div><b>Jam:</b> ${item.jam}</div>` : ``}
        ${item.ruang ? `<div><b>Ruang:</b> ${item.ruang}</div>` : ``}
      </div>

      <div class="flex flex-col gap-3 mb-4">

        ${
          item.linkWA
            ? `<a href="${item.linkWA}" target="_blank"
                 class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-center">
                 Gabung Grup WA
               </a>`
            : `<span class="text-sm text-gray-500">Grup WA belum tersedia</span>`
        }

        ${
          item.linkZoom
            ? `<a href="${item.linkZoom}" target="_blank"
                 class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-center">
                 ${
                   item.roomZoom 
                   ? `Masuk Zoom ke Room ${item.roomZoom}`
                   : `Masuk Zoom`
                 }
               </a>`
            : `<span class="text-sm text-gray-500">Link Zoom belum tersedia</span>`
        }

      </div>

      <div class="flex flex-col gap-2">
        <button onclick="kembaliKeKelas()"
          class="text-sm text-blue-600 hover:text-blue-800 underline text-left">
          ‚Üê Kembali ke daftar kelas
        </button>

        <button onclick="kembaliKeDosen()"
          class="text-sm text-gray-500 hover:text-gray-700 underline text-left">
          ‚Üê Kembali ke daftar dosen
        </button>
      </div>
    </div>
  `;
}

function kembaliKeKelas() {
  document.querySelectorAll(".kelas-card")
    .forEach(k => k.classList.remove("hidden"));
  document.getElementById("detail").innerHTML = "";
}

function kembaliKeDosen() {
  document.getElementById("detail").innerHTML = "";
  tampilkanDaftarDosen(globalData);
}

/* Proteksi ringan */

document.addEventListener('contextmenu', e => e.preventDefault());

document.addEventListener('keydown', function(e) {
  if (e.key === "F12") e.preventDefault();
  if (e.ctrlKey && e.shiftKey && ["I","C","J"].includes(e.key)) e.preventDefault();
  if (e.ctrlKey && e.key === "u") e.preventDefault();
});

</script>

</body>
</html>
