<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pencarian Jadwal Dosen</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-3">

<div class="max-w-sm mx-auto bg-transparent">

  <h2 class="text-lg font-semibold mb-3 text-gray-800 text-center">
    üîé Cek Jadwal
  </h2>

  <!-- Input -->
  <div>
    <input 
      type="text" 
      id="searchInput"
      placeholder="Ketik minimal 3 huruf nama dosen..."
      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
  </div>

  <!-- Tombol di bawah -->
  <div class="mt-2">
    <button 
      onclick="cariDosen()"
      class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
    >
      Cari
    </button>
  </div>

  <div id="message" class="mt-3 text-sm text-gray-500 text-center"></div>
  <div id="results" class="mt-4 space-y-3"></div>
  <div id="detail" class="mt-6"></div>

</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzDriaNyxlLy_-BxY6BCYkbibonLoEXfnos41T5JCMJzjFdJmkqOQTXj-IVPOrBYwz3/exec";

const warnaList = [
  "border-blue-500",
  "border-green-500",
  "border-red-500",
  "border-purple-500",
  "border-orange-500",
  "border-teal-500"
];

function cariDosen() {

  const keyword = document.getElementById("searchInput").value.trim();
  const messageDiv = document.getElementById("message");
  const resultsDiv = document.getElementById("results");
  const detailDiv = document.getElementById("detail");

  resultsDiv.innerHTML = "";
  detailDiv.innerHTML = "";
  messageDiv.innerHTML = "";

  if (keyword.length < 3) {
    messageDiv.innerHTML = "Minimal 3 huruf untuk mencari.";
    return;
  }

  messageDiv.innerHTML = "Loading data...";

  fetch(API_URL + "?search=" + encodeURIComponent(keyword))
    .then(res => res.json())
    .then(data => {
      messageDiv.innerHTML = "";
      tampilkanHasil(data);
    })
    .catch(() => {
      messageDiv.innerHTML = "Terjadi kesalahan mengambil data.";
    });
}

function tampilkanHasil(data) {

  const resultsDiv = document.getElementById("results");
  const messageDiv = document.getElementById("message");

  if (!data || data.length === 0) {
    messageDiv.innerHTML = "Data tidak ditemukan.";
    return;
  }

  data.forEach((item, index) => {

    const card = document.createElement("div");

    const warna = data.length > 1
      ? warnaList[index % warnaList.length]
      : "border-blue-500";

    card.className = `
      border-l-4 ${warna}
      bg-white
      p-4
      rounded-xl
      shadow-sm
      hover:shadow-md
      cursor-pointer
      transition
    `;

    card.innerHTML = `
      <div class="font-semibold text-gray-800">${item.dosen}</div>
      <div class="text-sm text-gray-600 mt-1">
        ${item.matkul} | Kelas ${item.kelas}
      </div>

      <div class="mt-3 inline-block px-3 py-1 bg-orange-100 rounded-full text-xs">
        <span class="text-gray-500 font-medium">PRODI:</span>
        <span class="text-orange-700 font-semibold">${item.prodi}</span>
      </div>
    `;

    card.onclick = function() {

      document.querySelectorAll("#results > div")
        .forEach(k => { if (k !== card) k.classList.add("hidden"); });

      tampilkanDetail(item);
    };

    resultsDiv.appendChild(card);
  });
}

function tampilkanDetail(item) {

  const detailDiv = document.getElementById("detail");

  detailDiv.innerHTML = `
    <div class="bg-white p-5 rounded-xl shadow-md">
      <h3 class="font-semibold text-gray-800 mb-3">Link Kelas</h3>

      <div class="flex flex-wrap gap-2">
        ${
          item.linkWA
            ? `<a href="${item.linkWA}" target="_blank"
                 class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                 Gabung Grup WA
               </a>`
            : `<span class="text-sm text-gray-500">Grup WA belum tersedia</span>`
        }

        ${
          item.linkZoom
            ? `<a href="${item.linkZoom}" target="_blank"
                 class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                 Masuk Zoom
               </a>`
            : `<span class="text-sm text-gray-500">Link Zoom belum tersedia</span>`
        }
      </div>

      <button onclick="resetHasil()"
        class="mt-4 text-sm text-gray-500 hover:text-gray-700 underline">
        ‚Üê Kembali ke daftar
      </button>
    </div>
  `;
}

function resetHasil() {
  document.querySelectorAll("#results > div")
    .forEach(k => k.classList.remove("hidden"));
  document.getElementById("detail").innerHTML = "";
}

/* ===== PROTEKSI RINGAN ===== */

/* Disable klik kanan */
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
});

/* Disable shortcut developer tools */
document.addEventListener('keydown', function(e) {

  if (e.key === "F12") {
    e.preventDefault();
  }

  if (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "C" || e.key === "J")) {
    e.preventDefault();
  }

  if (e.ctrlKey && e.key === "u") {
    e.preventDefault();
  }

});

</script>

</body>
</html>
