<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cek Rekapan Kehadiran</title>

<style>
:root{
  --primary:#0f5132;
  --bg:#f4f7f6;
  --text:#333;
  --muted:#777;
  --soft:#eef2f1;
  --danger:#b02a37;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI", Arial, sans-serif;
  background:linear-gradient(135deg,#eaf5ef,#f7faf9);
  padding:28px 14px;
  color:var(--text);
}

.container{
  max-width:520px;
  margin:auto;
}

.card{
  background:#fff;
  border-radius:18px;
  box-shadow:0 18px 42px rgba(0,0,0,.12);
  padding:26px;
  animation:fadeUp .5s ease;
}

@keyframes fadeUp{
  from{opacity:0; transform:translateY(18px)}
  to{opacity:1; transform:translateY(0)}
}

.header{
  text-align:center;
  margin-bottom:22px;
}

.header h2{
  margin:0;
  font-size:21px;
  color:var(--primary);
}

.header p{
  margin:6px 0 0;
  font-size:13px;
  color:var(--muted);
}

label{
  display:block;
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
}

select,input{
  width:100%;
  padding:12px 14px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:14px;
}

select:focus,input:focus{
  outline:none;
  border-color:var(--primary);
}

button{
  width:100%;
  margin-top:18px;
  padding:12px;
  border:none;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
}

button:hover{opacity:.9}

/* LIST HASIL */
.list{
  margin-top:14px;
  border:1px solid #e0e6e4;
  border-radius:14px;
  max-height:240px;
  overflow:auto;
  animation:fadeUp .3s ease;
}

.item{
  padding:12px 14px;
  cursor:pointer;
  border-bottom:1px solid #edf1f0;
  transition:.2s;
}

.item:last-child{border-bottom:none}

.item:hover{
  background:#f1f5f4;
}

/* HASIL DETAIL */
.result{
  margin-top:24px;
  text-align:center;
  animation:fadeUp .4s ease;
}

.avatar{
  width:120px;
  height:120px;
  margin:0 auto 10px;
  border-radius:50%;
  object-fit:cover;
  box-shadow:0 6px 18px rgba(0,0,0,.2);
}

.name{
  font-size:16px;
  font-weight:600;
  margin-top:6px;
}

.badge{
  display:inline-block;
  margin-top:6px;
  padding:6px 14px;
  border-radius:20px;
  font-size:12px;
  background:var(--soft);
  color:var(--primary);
}

.total{
  margin-top:14px;
  font-size:14px;
}

.total b{
  font-size:22px;
  color:var(--primary);
}

.loading{
  font-size:13px;
  color:var(--muted);
}

.error{
  margin-top:10px;
  font-size:14px;
  color:var(--danger);
}

/* INFO BOX */
.info-box{
  margin-top:20px;
  padding:14px 16px;
  border-radius:14px;
  background:#f1f6f4;
  border-left:4px solid var(--primary);
  font-size:13px;
  color:#2f4f46;
}

.info-box b{color:var(--primary)}

.footer{
  margin-top:16px;
  font-size:11px;
  color:var(--muted);
  text-align:center;
}

/* RESPONSIVE */
@media (min-width:768px){
  .container{max-width:560px}
}
</style>
</head>

<body>

<div class="container">
  <div class="card">

    <div class="header">
      <h2>Cek Rekapan Kehadiran</h2>
      <p>Pencarian data peserta berdasarkan nama</p>
    </div>

    <label for="kegiatan">Pilih Kegiatan</label>
    <select id="kegiatan">
      <option value="">Memuat kegiatan...</option>
    </select>

    <label for="nama">Nama Peserta</label>
    <input type="text" id="nama" placeholder="Ketik minimal 3 huruf nama">

    <button onclick="cari()">Cari Data</button>

    <div id="list" class="list" style="display:none"></div>

    <div id="hasil" class="result"></div>

    <!-- CATATAN AKUMULASI -->
    <div class="info-box">
      <b>Catatan:</b><br>
      Akumulasi kehadiran ditampilkan berdasarkan <b>kegiatan terdahulu</b>.
      Data untuk <b>kegiatan yang sedang berjalan</b> akan
      <b>diperbarui kemudian</b>.
    </div>

    <!-- INFO KONSULTASI -->
    <div class="info-box">
      Jika terdapat kendala atau perbedaan data pada hasil rekapan,
      silakan <b>konfirmasi langsung</b> ke
      <b>Kantor AIK dan MKWK UMM Kampus 3</b>.
    </div>

    <div class="footer">
      Sistem ini menampilkan data sesuai basis data yang tercatat.
    </div>

  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxoIj0-R-DpcmjqQIW01dekT9CEuRHIyeJmsIZaZqlN6UPO0fnAL9gT0QvAuA5gy5LOiw/exec";

/* LOAD KEGIATAN */
async function loadKegiatan(){
  const sel=document.getElementById("kegiatan");
  try{
    const res=await fetch(API_URL+"?action=list_kegiatan");
    const json=await res.json();
    sel.innerHTML='<option value="">Pilih Kegiatan</option>';
    json.kegiatan.forEach(k=>{
      sel.innerHTML+=`<option value="${k}">${k}</option>`;
    });
  }catch(e){
    sel.innerHTML='<option value="">Gagal memuat kegiatan</option>';
  }
}

/* CARI NAMA */
async function cari(){
  const nama=document.getElementById("nama").value.trim();
  const kegiatan=document.getElementById("kegiatan").value;
  const list=document.getElementById("list");
  const hasil=document.getElementById("hasil");

  list.style.display="none";
  list.innerHTML="";
  hasil.innerHTML="";

  if(!kegiatan || nama.length<3){
    alert("Pilih kegiatan dan ketik minimal 3 huruf nama");
    return;
  }

  list.style.display="block";
  list.innerHTML='<div class="item">Mencari data...</div>';

  const res=await fetch(
    API_URL+
    "?action=cari_nama&kegiatan="+encodeURIComponent(kegiatan)+
    "&nama="+encodeURIComponent(nama)
  );
  const json=await res.json();

  list.innerHTML="";

  if(json.hasil.length===0){
    list.innerHTML='<div class="item">Tidak ada data ditemukan</div>';
    return;
  }

  json.hasil.forEach(h=>{
    const div=document.createElement("div");
    div.className="item";
    div.textContent=h.nama;
    div.onclick=()=>detail(h.kode);
    list.appendChild(div);
  });
}

/* DETAIL PESERTA */
async function detail(kode){
  const kegiatan=document.getElementById("kegiatan").value;
  const list=document.getElementById("list");
  const hasil=document.getElementById("hasil");

  list.style.display="none";
  hasil.innerHTML='<div class="loading">Memuat data...</div>';

  const res=await fetch(
    API_URL+
    "?action=detail&kegiatan="+encodeURIComponent(kegiatan)+
    "&kode="+encodeURIComponent(kode)
  );
  const json=await res.json();

  if(json.status!=="ok"){
    hasil.innerHTML='<div class="error">Data tidak ditemukan</div>';
    return;
  }

  hasil.innerHTML=`
    ${json.data.foto?`<img src="${json.data.foto}" class="avatar">`:``}
    <div class="name">${json.data.nama}</div>
    <div class="badge">${json.data.ket||"-"}</div>
    <div class="total">
      Total Kehadiran<br>
      <b>${json.data.total}</b>
    </div>
  `;
}

loadKegiatan();
</script>

</body>
</html>
